- name: "Fix homebrew permissions"
  file:
    path: /usr/local/bin
    owner: dan
    group: staff
    recurse: yes
  become: true
  tags:
    - homebrew
    - homebrew_perm_fix

- name: "Update homebrew"
  homebrew:
    update_homebrew: yes
  tags:
    - homebrew

- name: "Install homebrew packages"
  homebrew:
    update_homebrew: no
    name: "{{ item }}"
    state: latest
  with_items:
    - abook
    - ansible
    - aspell
    - bash
    - bookloupe
    - colordiff
    - composer
    - coreutils
    - cpanminus
    - cscope
    - ctags
    - ctop
    - cvs
    - euler-py
    - exercism
    - exif
    - exiftool
    - fswatch
    - git
    - git-lfs
    - gnupg
    - gnupg2
    - gpg-agent
    - graphviz
    - grip
    - groff
    - gron
    - highlight
    - htop
    - httpd
    - httpie
    - hugo
    - ipython
    - jhead
    - jid
    - jq
    - lua
    - luajit
    - lynx
    - md5sha1sum
    - mercurial
    - micro
    - mkcert
    - mobile-shell
    - mosh
    - most
    - mtr
    - multimarkdown
    - mutt
    - nethogs
    - nginx
    - ngrep
    - nmap
    - node
    - nvm
    - perl
    - php70
    - php@7.0
    - postgresql
    - python
    - python3
    - python@2
    - reattach-to-user-namespace
    - ruby
    - shyaml
    - sipcalc
    - slackcat
    - sloccount
    - socat
    - telnet
    - the_silver_searcher
    - tidy-html5
    - tig
    - tmux
    - tnef
    - tree
    - unrar
    - vim
    - watchman
    - wget
    - xz
    - yamllint
    - yarn
    - youtube-dl
  notify: "Brew administrative tasks"
  tags:
    - homebrew

- name: "Upgrade homebrew packages"
  homebrew:
    update_homebrew: no
    upgrade_all: yes
  notify: "Brew administrative tasks"
  tags:
    - homebrew

- name: "Install hiera-eyaml gem"
  gem:
    name: hiera-eyaml
    state: present
    executable: /usr/local/bin/gem
    user_install: no
  tags:
    - puppet

- name: "Install hiera-eyaml-gpg gem"
  gem:
    name: hiera-eyaml-gpg
    state: present
    executable: /usr/local/bin/gem
    user_install: no
  tags:
    - puppet

- name: "Install gpgme gem"
  gem:
    name: gpgme
    state: present
    executable: /usr/local/bin/gem
    user_install: no
  tags:
    - puppet

- name: "Install yard gem"
  gem:
    name: yard
    state: present
    executable: /opt/puppetlabs/puppet/bin/gem
    user_install: no
  become: true
  tags:
    - puppet

- name: "Install puppet-strings gem"
  gem:
    name: puppet-strings
    state: present
    executable: /opt/puppetlabs/puppet/bin/gem
    user_install: no
  become: true
  tags:
    - puppet

- name: "Install Jupyter Python environment"
  pip:
    name: "{{ item }}"
    extra_args: "--upgrade"
    executable: /usr/local/bin/pip3
  with_items:
    - pip
    - jupyter
    - pyzmq
  tags:
    - python
    - jupyter

- name: "Install Jupyter JavaScript/Node.js environment"
  yarn:
    name: ijavascript
    global: yes
    production: yes
    state: latest
  tags:
    - nodejs
    - jupyter
  notify: "Install jupyter nodejs"

- name: "Create nodebook data directory"
  file:
    owner: dan
    group: staff
    mode: 0755
    path: "{{ ansible_user_dir }}/Dropbox/Apps/nbk"
    state: directory
  tags:
    - nodejs
    - nodebook
    - nbk

- name: "Install nodebook"
  yarn:
    name: nbk
    global: yes
    production: yes
    state: latest
  tags:
    - nodejs
    - nodebook
    - nbk

- name: "Install nodebook service"
  template:
    src: com.tangledhelix.nbk.plist.j2
    dest: "{{ ansible_user_dir }}/Library/LaunchAgents/com.tangledhelix.nbk.plist"
  tags:
    - nodejs
    - nodebook
    - nbk
  notify: "Set up nodebook"

